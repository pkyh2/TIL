# 공공 데이터를 이용한 상권 분석

## 소상공인시장진흥공단_상가(상권)정보

### 테이블 조회

```sqlite
SELECT count(*) FROM 상가분석;

SELECT DISTINCT 시도명
FROM 상가분석;

SELECT DISTINCT 시군구명
FROM 상가분석
WHERE 시도명 = '서울특별시'
ORDER BY 시군구명;

-- 서울 경기 공차% 조회
SELECT 상호명, 시도명, 시군구명, 행정동명
FROM 상가분석
WHERE 시도명 in ('경기도', '서울특별시') and 상호명 like '공차%'
ORDER BY 시군구명, 행정동명;

-- 지역별 매장 수
select 시도명, 시군구명, count(*)
from 상가분석
where 시도명 in ('서울특별시', '경기도', '인천광역시') and 상호명 like '공차%'
group by 시도명, 시군구명
```

## 주민등록인구 및 세대현황_월간(2021.12)

### 테이블 조회

```sqlite
select 행정구역, `2021년12월_총인구수`
from 인구현황;

select 행정구역, `2021년12월_총인구수` 인구수
from 인구현황
where 행정구역 like '경기도 성남시%'
```

### 상권 데이터와 인구 데이터를 조인

- **시군구별 매장수와 인구수**

  ```sqlite
  -- 상가분석 데이터에서 시도명 컬럼과, 시군구명 컬럼을 이어붙였다.
  select distinct 시도명 || ' ' || 시군구명 AS 행정구역
  from 상가분석
  
  -- 시군구별 매장수와 인구수
  select 시도명, 시군구명, 매장수, 인구수
  from
  	(select 시도명, 시군구명, count(*) as 매장수	-- 1)
  	from 상가분석
  	where 시도명 in ('서울특별시', '경기도', '인천광역시') and 상호명 like '공차%'
  	group by 시도명, 시군구명) 매장,
  	(select 행정구역, `2021년12월_총인구수` as 인구수	-- 2)
  	from 인구현황) 인구
  where 인구.행정구역 like 매장.시도명 || ' ' || 매장.시군구명 || '%'
  
  -- 1) 시도명, 시군구명, 매장수 -> 매장
  select 시도명, 시군구명, count(*) as 매장수	-- 1)
  from 상가분석
  where 시도명 in ('서울특별시', '경기도', '인천광역시') and 상호명 like '공차%'
  group by 시도명, 시군구명
  
  -- 2) 행정구역, 인구수 -> 인구
  select 행정구역, `2021년12월_총인구수` as 인구수
  from 인구현황
  
  /*그래서 where에서 매장. 에서 시도명, 시군구 합친 값과 인구.행정구역의 값이 같은 값만 출력*/
  ```

  

- **매장 당 인구수 구하기**

  ```sqlite
  select *
  from (
  	select 시도명, 시군구명, 매장수, 인구수, 인구수/매장수 as 매장당인구수
  	from
  	(select 시도명, 시군구명, count(*) 매장수
  	from 상가분석
  	where 시도명 in ('서울특별시', '경기도', '인천광역시') and 상호명 like '공차%'
  	group by 시도명, 시군구명) 매장,		-- 1)
  	(select
  		행정구역,
  		replace(`2021년12월_총인구수`, ',', '') as 인구수
  		from 인구현황
  		where `2021년12월_총인구수` IS NOT 0) 인구		-- 2)
      where 인구.행정구역 like 매장.시도명 || ' ' || 매장.시군구명 || '%'
  )
  
  order by 시도명, 시군구명
  
  -- 1)은 위에랑 똑같음
  -- 2)는 `2021년12월_총인구수`에서 인구수/매장수를 계산하기 위해 ','를 제거하고,
  -- 		인구 수가 0인 값은 제외
  select
  행정구역,
  replace(`2021년12월_총인구수`, ',', '') as 인구수
  from 인구현황
  where `2021년12월_총인구수` IS NOT 0
  ```

  ```sqlite
  -- 같은 결과
  select
      시도명,
      시군구명,
      count(*) 매장수,
      `2020년01월_총인구수` 인구수,
      replace(`2020년01월_총인구수`, ',', '') / count(*) as 매장당인구수
  from 상가업소정보_201912 매장, 주민등록인구및세대현황 인구
  where 인구.행정구역 like 매장.시도명 || ' ' || 매장.시군구명 || '%'
  and 시도명 in ('서울특별시', '경기도', '인천광역시') and 상호명 like '공차%'
  group by 시도명, 시군구명
  order by 매장당인구수 asc
  ```

  

- **연습문제**

  ```sqlite
  select *
  from (
      -- cast(인구수 as REAL) 또는 (인구수 + 0.00)
  	select 시도명, 시군구명, 매장수, 인구수, round(cast(인구수 as REAL)/매장수, 1) as 매장당인구수
  	from
  	(select 시도명, 시군구명, count(*) 매장수
  	from 상가분석
  	where 시도명 in ('서울특별시', '경기도', '인천광역시') and 상호명 like '공차%'
  	group by 시도명, 시군구명) 매장,
  	(select
  		행정구역,
  		replace(`2021년12월_총인구수`, ',', '') as 인구수
  		from 인구현황
  		where `2021년12월_총인구수` IS NOT 0) 인구
      where 인구.행정구역 like 매장.시도명 || ' ' || 매장.시군구명 || '%'
  )
  
  order by 시도명, 시군구명
  ```

  

## 상권업종에 따른 분석

### 서울특별시 구별 치킨집 매장 당 인구 수

- **서울특별시 구별 치킨집 목록**

  ```sqlite
  -- 시도명(서울특별시), 시군구명, 상권업종중분류명(닭/오리요리), 상권업종소분류명(후라이드/양념치킨)
  select 시도명, 시군구명, 상호명, 상권업종소분류명
  from 상가분석
  where 시도명 = '서울특별시' and 상권업종소분류명 = '후라이드/양념치킨'
  ORDER BY 시군구명
  
  -- 구별 치킨집 개수 구하기
  select 시도명 || ' ' || 시군구명 as 행정구역, count(*) as 치킨집수
  from 상가분석
  where 시도명 = '서울특별시' and 상권업종소분류명 = '후라이드/양념치킨'
  group by 시군구명
  ```

- **서울특별시 구별 인구 수**

  ```sqlite
  -- 서울특별시 구별 인구 수
  select 행정구역, `2021년12월_총인구수`
  from 인구현황
  where 행정구역 like '서울특별시%'
  ```

- **치킨집 수와 총 인구 수 테이블를 조인**

  ```sqlite
  -- 상가 테이블에서 치킨집수 컬럼과 인구 테이블에서 인구수 컬럼을 조건에 맞는 row에 추가
  select 시도명, 시군구명, 치킨집수, 인구수
  from
  	(select 시도명, 시군구명, count(*) as 치킨집수
  	from 상가분석
  	where 시도명 = '서울특별시' and 상권업종소분류명 = '후라이드/양념치킨'
  	group by 시군구명) 치킨,
  	(select 행정구역, `2021년12월_총인구수` as 인구수
  	from 인구현황) 인구
  where 인구.행정구역 like 치킨.시도명 || ' ' || 치킨.시군구명 || '%';
  ```

- **치킨집 수당 인구수 컬럼 구하기**

  ```sqlite
  select *
  from (
  	select 시도명, 시군구명, 치킨집수, 인구수, 인구수/치킨집수 as 치킨집당인구수
  	from
  		(select 시도명, 시군구명, count(*) as 치킨집수
  		from 상가분석
  		where 시도명 = '서울특별시' and 상권업종소분류명 = '후라이드/양념치킨'
  		group by 시군구명) 치킨,
  		(select 행정구역,
  		replace(`2021년12월_총인구수`, ',', '') as 인구수
  		from 인구현황) 인구
  	where 인구.행정구역 like 치킨.시도명 || ' ' || 치킨.시군구명 || '%'
  )
  order by 치킨집당인구수 asc;
  ```



### 서울특별시 구별 카페 분석

```sqlite
select 시도명, 시군구명, 상호명, 상권업종소분류명
from 상가분석
where 시도명 = '서울특별시' and 상권업종소분류명 = '커피전문점/카페/다방'
ORDER BY 시군구명

select 시도명, 시군구명, count(*) as 카페수
from 상가분석
where 시도명 = '서울특별시' and 상권업종소분류명 = '커피전문점/카페/다방'
group by 시군구명

select 시도명, 시군구명, 카페수, 인구수
from
	(select 시도명, 시군구명, count(*) as 카페수
	from 상가분석
	where 시도명 = '서울특별시' and 상권업종소분류명 = '커피전문점/카페/다방'
	group by 시군구명) 카페,
	(select 행정구역, `2021년12월_총인구수` as 인구수
	from 인구현황) 인구
where 인구.행정구역 like 카페.시도명 || ' ' || 카페.시군구명 || '%';

select *
from (
	select 시도명, 시군구명, 카페수, 인구수, 인구수/카페수 as 카페당인구수
	from
		(select 시도명, 시군구명, count(*) as 카페수
		from 상가분석
		where 시도명 = '서울특별시' and 상권업종소분류명 = '커피전문점/카페/다방'
		group by 시군구명) 카페,
		(select 행정구역,
		replace(`2021년12월_총인구수`, ',', '') as 인구수
		from 인구현황) 인구
	where 인구.행정구역 like 카페.시도명 || ' ' || 카페.시군구명 || '%'
)
order by 카페당인구수 asc;
```



