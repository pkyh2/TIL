# WebSocket

웹소켓은 컴퓨터 세상의 프로토콜로 Client와 Server사이에 실시간 양방향 통신을 하기 위한 기술이다.
가상화폐 거래소에서는 실시간 데이터를 전송하는데 웹소켓을 사용하고 있다.

또한, WebSocket API를 통해 서버로 메시지를 보내고, 요청 없이 응답을 받아오는 것이 가능하다.

웹소켓은 별도의 포트를 사용하지 않고 HTTP와 같은 80번 포트를 사용하고 있는데, 이 때문에 Client인 웹 브라우저 뿐만 아니라 웹 서버도 기능을 지원하고 있어야 한다.

## Django Channels

Channels는 웹소켓, 채팅 프로토콜, IOT 프로토콜 등을 처리하기 위해 Django를 HTTP 이상으로 확장하는 프로젝트입니다. ASGI라는 Python 사양을 기반으로 합니다.

Django에서 HTTP프로토콜이 아닌 다른 프로토콜을 사용할 수 있게 해줍니다. 따라서 Websocket은 프로토콜의 일종으로써 이를 사용하기 위해 Channels를 이용하는 것입니다.

https://ssungkang.tistory.com/entry/Django-Channels-%EB%B9%84%EB%8F%99%EA%B8%B0%EC%A0%81-%EC%B1%84%ED%8C%85-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-WebSocket-1
그림 참고

### ASGI

- Asynchronous Server Gateway Interface의 줄임말
- 비동기가 가능한 Python 웹서버, 프레임워크 및 응용 프로그램 간의 표준 인터페이스를 제공하기 위한 WSGI의 후속 제품
- WSGI가 앱에 대한 표준을 제공했다면, ASGI는 이전 버번과의 호환성 구현, 다중서버 및 애플리케이션 프레임워크를 통해 비동기 및 동기 앱 모두에 대한 표준을 제공한다.
- ASGI는 비동기 요청인 웹 소켓을 처리하는 이벤트로써 connect, send, receive, disconnect가 있습니다.

### WSGI

- Web server gateway interface
- Client가 Web server에 동적 페이지 요청이 들어오면 웹서버는 파이썬 프로그램을 호출해야 하는데 대부분의 웹서버는 파이썬 프로그램을 호출할 수 없다.
- 이러한 이유로 파이썬 프로그램을 호출하는 WSGI서버가 반드시 필요하다.
- 웹서버에서 동적 요청이 발생하면 웹서버가 WSGI서버를 호출하고, WSGI서버는 파이썬을 호출하여 동적 페이지 요청을 대신 처리한다.
- WSGI는 웹서버가 동적 페이지 요청을 처리하기 위해 호출하는 서버다.
- WSGI 서버에 여러 종류가 있지만 `uwsgi`와 `Gunicorn`을 많이 사용한다. <u>우리는 `uwsgi`를 사용</u>

### 동기와 비동기

#### 동기

- 동기는 말 그대로 동시에 일어난다.
- 요청과 그 결과가 동시에 일어난다.
- 어떤 요청을 보내면 그 결과가 얼마나 걸리든 결과가 나오고 나서 다른 작업을 수행한다.

#### 비동기

- 동시에 일어나지 않는다.
- 어떤 요청을 보내면 그 결과가 얼마나 걸리든 상관없이 다른 작업을 할 수 있으므로 자원을 효율적으로 사용할 수 있다.

### Consumer

각 함수별 역할

- `connect` : 사용자와 websocket 연결이 맺어졌을 때 호출
- `receive` : 사용자가 메시지를 보내면 호출 됨.
- `disconnect` : 사용자와 websocket 연결이 끊겼을 때 호출

### Channel layer?

- `channel layer`는 의사소통 시스템 입니다. 즉 많은 소비자들 더 나아가서는 django의 다른 부분과 의사소통을 할 수 있게 해줍니다.

  - channel

    channel은 메시지를 보낼 수 있는 **우편함** 이라고 생각하면 됩니다. 각 채널은 고유한 이름이 있으며 누구든지 채널에 메세지를 보낼 수 있습니다.

  - group

    group 은 채널과 관련된 그룹입니다. 그룹도 마찬가지로 이름을 가지며 그룹 이름을 가진 사용자는 누구나 그룹에 채널을 추가 / 삭제 가능하고 그룹의 모든 채널에게 메세지를 보낼 수 있습니다. 그러나 그룹에 속한 채널을 나열 할 수 없습니다.

  소비자들을 채널 이름을 하나씩 가지고 있으며 Channel layer 를 통해 메세지를 주고 받을 수 있습니다.



## REST API와 Websocket API

### REST API

- REST API로 데이터가 전송되는 것은 항상 누군가가 그 데이터를 요청한 것의 결과입니다.
- REST API로 요청한 페이지는 한 번 요청하면 내용이 변하지 않는다.
- 반면에, 주식거래 가격 사이트는 엔터를 치지도 않았는데 실시간으로 가격이 변동한다. 이것을 REST API로 구현하려면 새로고침을 무한으로 해줘야 한다.

### Websocket API

- 데이터 요청자와 데이터 제공자 사이에 채널이 열린다.
- 채널이 열리기 전에 데이터 요청자는 어떤 데이터를 받고 싶은지 데이터 제공자에게 알려주도록 되어 있다.
